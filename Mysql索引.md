---
title: Mysql索引
date: 2020-02-15 21:05:38
categories: 数据库
tags:
- mysql 
- 索引
---

{% asset_img image01.png  %}

<!-- more -->

# **MyISAM索引引擎（非聚集索引）**

​    索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。

# **InnoDB 索引引擎（聚集索引）**

​    B+Tree作为索引引擎，数据文件本身就是索引文件，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。

# **最左前缀原理及优化**

1. **全列匹配**

​       当按照索引中所有列进行精确匹配（这里精确匹配指“=”或“IN”匹配）时，索引可以被用到。

​       理论上索引对顺序是敏感的，但是由于MySQL的查询优化器会自动调整where子句的条件顺序以使用适合的索引。

2. **最左前缀匹配**

当查询条件精确匹配索引的左边连续一个或几个列时,如索引是A-B-C，where子句用到了A或者A-B,可以走部分索引，即条件组成的最左前缀。

3.  **查询条件用到了索引中列的精确匹配，但是中间某个条件未提供**

如索引是A-B-C,查询的where子句是A-C,根据最左前缀匹配规则，只走A索引。

4. **查询条件没有指定索引第一列**

​     由于不是最左前缀，索引这样的查询显然用不到索引。

5. **匹配某列的前缀字符串**

​      如果通配符%不出现在开头，则可以用到索引，但根据具体情况不同可能只会用其中一个前缀。

6. **范围查询**

​       范围列可以用到索引（必须是最左前缀），但是范围列后面的列无法用到索引。同时，索引最多用于一个范围列，因此如果查询   条件中有两个范围列则无法全用到索引

7. **查询条件中含有函数或表达式**

​         如果查询条件中含有函数或表达式，则MySQL不会为这列使用索引。

#  **InnoDB的主键选择与插入优化**

在使用InnoDB存储引擎时，如果没有特别的需要，请永远使用一个与业务无关的自增字段作为主键。

InnoDB使用聚集索引，数据记录本身被存于主索引（一颗B+Tree）的叶子节点上。这就要求同一个叶子节点内（大小为一个内存页或磁盘页）的各条数据记录按主键顺序存放，因此每当有一条新的记录插入时，MySQL会根据其主键将其插入适当的节点和位置，如果页面达到装载因子（InnoDB默认为15/16），则开辟一个新的页（节点）。

如果表使用自增主键，那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，当一页写满，就会自动开辟一个新的页。

这样就会形成一个紧凑的索引结构，近似顺序填满。由于每次插入时也不需要移动已有数据，因此效率很高，也不会增加很多开销在维护索引上。